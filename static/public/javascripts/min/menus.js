$(function(){function n(n,i){$.ajax({url:"/api/i18n",type:"GET",data:{phrases:n}}).done(function(n){s=Object.assign(s,n),t(o,e,a.page||1)})}function t(n,e,o){var s="/api/menu";o&&(s=s+"?page="+o),$.get(s,n).done(function(o){if(a={total:o.total,limit:o.limit,page:o.page,pages:o.pages},o.docs&&o.docs.length>0||1===o.page){i=o.docs,$("#menus").replaceWith(e(o));var s=$(".tbl-content").width()-$(".tbl-content table").width();$(".tbl-header").css({"padding-right":s})}else t(n,e,o.page-1)})}var e,a,i=[],o=null,s={};Handlebars.registerHelper("__",function(t){var e=s[t];if(e)return e;n([t])}),$.ajax({url:"/api/i18n",type:"GET",data:{phrases:["Link","Text","Actions","Link can not contain less than 1 characters","Text can not contain less than 2 characters"]}}).done(function(n){s=n,$.get("/static/handlebars/menus.hbs").done(function(n){e=Handlebars.compile(n),t(o,e)})}),$("body").on("click","a[data-action=delete-menu-item]",function(){var n=$(this).attr("data-self-link");return $("#confirm-delete").off("click","#delete"),$("#confirm-delete").modal().one("click","#delete",function(i){$.ajax({url:n,type:"DELETE",success:function(n){n._id&&t(o,e,a.page)}})}),!1}),$("a[data-action=add][data-target=menu-item]").click(function(){var n=$("#add-menu-item");return n.on("hidden.bs.modal",function(){n.find(".invalid").tooltip("hide"),n.find(".invalid").removeClass("invalid")}),n.off("click","#save"),n.modal().one("click","#save",function(){var i={href:n.find("#link").val(),text:n.find("#text").val()};$.ajax({url:"/api/menu",type:"POST",contentType:"application/json",data:JSON.stringify(i),success:function(i){console.log("success",i),n.find("#link").val(""),n.find("#text").val(""),n.modal("hide"),i._id&&t(o,e,a.page)},error:function(t){console.log(t),void 0!==t.responseJSON.validations&&void 0!==t.responseJSON.validations.body&&t.responseJSON.validations.body.forEach(function(t){t&&"request.body.text"===t.property&&(console.log(t),n.find("#text").addClass("invalid"),n.find("#text").attr("title",s["Text can not contain less than 2 characters"]||"Text can not contain less than 2 characters"),n.find("#text").tooltip("show")),t&&"request.body.href"===t.property&&(n.find("#link").addClass("invalid"),n.find("#link").attr("title",s["Link can not contain less than 1 characters"]||"Link can not contain less than 1 characters"),n.find("#link").tooltip("show"))})}})}),!1}),$("body").on("keyup",".invalid",function(){$(this).removeClass("invalid")}),$("body").on("click","a[data-action=save-menu-item]",function(){var n=$(this).attr("data-self-link"),c=$(this).attr("data-id"),l=i.find(function(n){return n._id===c});if(!l)return void alert("Menu item with id = ["+c+"] does not exists");l.href=$("#"+c+" [name=href]").val(),l.text=$("#"+c+" [name=text]").val();var r=$("#confirm-save").modal();return r.off("click","#save"),r.one("click","#save",function(){console.log("hello"),$.ajax({url:n,type:"PUT",contentType:"application/json",data:JSON.stringify(l),success:function(n){console.log("success",n),n._id&&t(o,e,a.page)},error:function(n){void 0!==n.responseJSON.validations&&void 0!==n.responseJSON.validations.body&&n.responseJSON.validations.body.forEach(function(n){n&&"request.body.text"===n.property&&(console.log(n),$("#"+c+" [name=text]").addClass("invalid"),$("#"+c+" [name=text]").attr("title",s["Text can not contain less than 2 characters"]||"Text can not contain less than 2 characters"),$("#"+c+" [name=text]").tooltip("show")),n&&"request.body.href"===n.property&&($("#"+c+" [name=href]").addClass("invalid"),$("#"+c+" [name=href]").attr("title",s["Link can not contain less than 1 characters"]||"Link can not contain less than 1 characters"),$("#"+c+" [name=href]").tooltip("show"))})}})}),!1}),io("/admin").on("menu/new",function(){t(o,e,a.page)})});